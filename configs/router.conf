# ============================================================
# VyOS Edge Router Configuration
# Enterprise Network Lab
# ============================================================
# Router: VyOS 1.4 (Sagitta)
# Hostname: edge-router
# Role: Edge router with inter-VLAN routing, NAT, and default gateway
# ============================================================

# --- System Configuration ---
set system host-name 'edge-router'
set system domain-name 'enterprise.lab'
set system name-server '10.0.10.10'
set system time-zone 'America/New_York'

# Enable SSH for remote management
set service ssh port '22'
set service ssh listen-address '10.0.1.1'

# --- Interface Configuration ---

# WAN Interface (to ISP)
set interfaces ethernet eth0 address '203.0.113.1/30'
set interfaces ethernet eth0 description 'WAN - ISP Uplink'

# LAN Interface (to Core Switch)
set interfaces ethernet eth1 address '10.0.1.1/30'
set interfaces ethernet eth1 description 'LAN - Core Switch Uplink'

# VLAN Sub-interfaces on LAN (Router-on-a-Stick)
set interfaces ethernet eth1 vif 10 address '10.0.10.1/24'
set interfaces ethernet eth1 vif 10 description 'VLAN 10 - Servers'

set interfaces ethernet eth1 vif 20 address '10.0.20.1/24'
set interfaces ethernet eth1 vif 20 description 'VLAN 20 - Clients'

# --- Routing ---

# Default route to ISP
set protocols static route 0.0.0.0/0 next-hop '203.0.113.2'

# Connected routes for VLANs are automatically added via interfaces
# Verify with: show ip route

# --- NAT (Source NAT for Internet Access) ---
set nat source rule 100 outbound-interface name 'eth0'
set nat source rule 100 source address '10.0.10.0/24'
set nat source rule 100 translation address 'masquerade'

set nat source rule 200 outbound-interface name 'eth0'
set nat source rule 200 source address '10.0.20.0/24'
set nat source rule 200 translation address 'masquerade'

# --- DNS Forwarding ---
set service dns forwarding listen-address '10.0.10.1'
set service dns forwarding listen-address '10.0.20.1'
set service dns forwarding allow-from '10.0.10.0/24'
set service dns forwarding allow-from '10.0.20.0/24'
set service dns forwarding name-server '10.0.10.10'

# --- DHCP Relay (forward to DHCP server in VLAN 10) ---
set service dhcp-relay interface 'eth1.20'
set service dhcp-relay server '10.0.10.11'
set service dhcp-relay relay-options relay-agents-packets 'discard'

# --- Firewall Zones (Basic) ---
set firewall group network-group SERVERS network '10.0.10.0/24'
set firewall group network-group CLIENTS network '10.0.20.0/24'
set firewall group network-group RFC1918 network '10.0.0.0/8'
set firewall group network-group RFC1918 network '172.16.0.0/12'
set firewall group network-group RFC1918 network '192.168.0.0/16'

# ============================================================
# Verification Commands:
#   show interfaces
#   show ip route
#   show nat source translations
#   show service dhcp-relay
#   ping 10.0.10.10 (DNS server)
#   ping 10.0.20.100 (Linux client)
#   traceroute 8.8.8.8 (verify internet path)
# ============================================================
